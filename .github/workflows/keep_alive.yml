name: Wake Streamlit App
on:
  schedule:
    - cron: "*/30 * * * *" # Runs every 30 minutes
  workflow_dispatch: # Allows manual trigger

jobs:
  wake_app:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repo
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.9'

      - name: Install dependencies
        run: |
          pip install requests

      - name: Run Wake Script
        shell: python
        run: |
          import time
          import requests

          url = "https://aryanasignment-sayjr7rvushwkwhsewnoxx.streamlit.app"

          def ping():
            response = requests.get(url, timeout=30)
            print(f"Status: {response.status_code}")
            return response.text

          print("Pinging app...")
          html = ping()

          # If the sleep page is served, wait for boot and ping again.
          if "This app has gone to sleep" in html:
            print("Sleep page detected. Waiting for app to boot...")
            time.sleep(60)
            html = ping()

          if "This app has gone to sleep" in html:
            print("App still asleep after retry.")
          else:
            print("App responded with active page.")
